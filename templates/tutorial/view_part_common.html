{# Morceau s'occupant d'afficher une partie #}
{% load markup %}

{% if user in part.tutorial.authors.all %}
<p> 
<div class="btn-group">
    <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
        Déplacer
        <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        {% if part.position_in_tutorial > 1 %}
        <li><a href="/tutoriels/modifier/partie?action=deplacer&amp;partie={{ part.pk }}&amp;position={{ part.position_in_tutorial|add:"-1" }}">
            <i class="icon-arrow-up"></i>
            Monter
        </a></li>
        {% endif %}
        {% if part.position_in_tutorial < tutorial.get_parts.count %}
        <li><a href="/tutoriels/modifier/partie?action=deplacer&amp;partie={{ part.pk }}&amp;position={{ part.position_in_tutorial|add:"1" }}">
            <i class="icon-arrow-down"></i>
            Descendre
        </a></li>
        {% endif %}
        <li class="disabled"><a href="#">&mdash; Déplacer avant</a></li>
        {% for part_mv in part.tutorial.get_parts %}
        {% if part != part_mv and part_mv.position_in_tutorial|add:"-1" != part.position_in_tutorial %}
        <li>
            <a href="/tutoriels/modifier/partie?action=deplacer&amp;partie={{ part.pk }}&amp;position={{ part_mv.position_in_tutorial }}">
                Partie {{ part_mv.position_in_tutorial }} : {{ part_mv.title }}
            </a>
        </li>
        {% endif %}
        {% endfor %}
        <li class="disabled"><a href="#">&mdash; Déplacer après</a></li>
        {% for part_mv in part.tutorial.get_parts %}
        {% if part != part_mv and part_mv.position_in_tutorial|add:"1" != part.position_in_tutorial %}
        <li>
            <a href="/tutoriels/modifier/partie?action=deplacer&amp;partie={{ part.pk }}&amp;position={{ part_mv.position_in_tutorial }}">
                Partie {{ part_mv.position_in_tutorial }} : {{ part_mv.title }}
            </a>
        </li>
        {% endif %}
        {% endfor %}

    </ul>
</div>
<div class="btn-group">
    <a href="/tutoriels/editer/partie?partie={{ part.pk }}"
        class="btn">
        <i class="icon-pencil"></i>
        Éditer
    </a>
    <a href="/tutoriels/modifier/partie?action=supprimer&amp;partie={{ part.pk }}"
        class="btn">
        <i class="icon-remove"></i>
        Supprimer
    </a>
</div>
</p>

{% endif %}

{{ part.introduction|markdown:"safe,codehilite,extra" }}

<p>
    {% if part.get_chapters.count > 0 %}
    Il y a {{ part.get_chapters.count }} chapitre{{ part.get_chapters.count|pluralize }} dans cette partie.
    {% else %}
    Il n'y a aucun chapitre dans cette partie.
    {% endif %}
</p>

{% if user in part.tutorial.authors.all %}
<p>
    <a href="/tutoriels/nouveau/chapitre?partie={{ part.pk }}" class="btn">
        <i class="icon-plus"></i>
        Ajouter un chapitre
    </a>
</p>
{% endif %}

<ol>
    {% for chapter in part.get_chapters %}
    <li>
    <a href="{{ chapter.get_absolute_url }}">{{ chapter.title }}</a><br />
        {% if user in tutorial.authors.all %}
        <div class="btn-group">
            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                Déplacer
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
            <li><a 
                {% if chapter.position_in_part > 1 %}
                    href="/tutoriels/modifier/chapitre?action=deplacer&amp;chapitre={{ chapter.pk }}&amp;position={{ chapter.position_in_part|add:"-1" }}"                 {% else %}
                    href="#" class="disabled"
                {% endif %}>
                <i class="icon-arrow-up"></i>
                Monter
            </a></li>
            <li><a 
                {% if chapter.position_in_part < part.get_chapters.count %}
                href="/tutoriels/modifier/chapitre?action=deplacer&amp;chapitre={{ chapter.pk }}&amp;position={{ chapter.position_in_part|add:"1" }}"                {% else %}
                href="#" class="disabled"
                {% endif %}>
                <i class="icon-arrow-down"></i>
                Descendre
            </a></li>  
            </ul>
        </div>
        <div class="btn-group">
            <a href="/tutoriels/editer/chapitre?chapitre={{ chapter.pk }}" class="btn btn-mini">
                <i class="icon-pencil"></i>
                Éditer
            </a>
            <a href="/tutoriels/modifier/chapitre?chapitre={{ chapter.pk }}&amp;action=supprimer" class="btn btn-mini">
                <i class="icon-remove"></i>
                Supprimer
            </a>
        </div>
        {% endif %}
    </li>
    {% endfor %}
</ol>

{{ part.conclusion|markdown:"safe,codehilite,extra" }}
