{% load humane_date %}
{% load upfirstletter %}

<div class="forum-entry">
    <div class="forum-entry-title
    {% if user.is_authenticated %}
        {% if topic.never_read %}
            unread
        {% endif %}
    {% endif %}">
        <a href="{{ topic.get_absolute_url }}">
            {{ topic.title }}
        </a>
        <p>
            {% if topic.subtitle %}
                {{ topic.subtitle }}
            {% else %}
                <span class="no-subtitle">Aucun sous-titre.</span>
            {% endif %}
        </p>
    </div>
    <div class="forum-entry-count">
        <span class="label">
            {{ topic.get_post_count|add:"-1" }}
        </span>
        <span class="label secondary">
            verr.
        </span>
    </div>
    <div class="forum-entry-desc">
        <p>
            {% with answer=topic.get_last_answer %}
                {% if answer %}
                    <a href="{{ answer.get_absolute_url }}">
                        {% with date=answer.pubdate|humane_date %}
                            {{ date|upfirstletter }}
                        {% endwith %}
                    </a>
                    par
                    <a href="{{ answer.author.get_absolute_url }}">
                        {{ answer.author.username }}
                    </a>
                {% else %}
                    Aucune réponse
                {% endif %}
            {% endwith %}
        </p>
    </div>
</div>

{% if topic.is_sticky %}
    <i class="icon-bookmark" title="Ce sujet est épinglé"></i>
{% endif %}
{% if topic.is_locked %}
    <i class="icon-lock" title="Ce sujet est verrouillé"></i>
{% endif %}
{% if topic.is_solved %}
    <i class="icon-ok" title="Ce sujet est résolu"></i>
{% endif %}

{% if user.is_authenticated %}
    {% with topic.last_read_post as last_read_post %}
        {% ifnotequal last_read_post topic.get_last_answer %}
            <i class="icon-eye-open"></i>
        {% endifnotequal %}
    {% endwith %}
{% endif %}
