{# Block displaying the list of forums belonging to a category #}
{% load humane_date %}
{% load upfirstletter %}

{% for forum in category.get_forums %}
<div class="forum-entry">
    <div class="forum-entry-title {% if user.is_authenticated and not forum.is_read %}unread{% endif %}">
        <a href="{{ forum.get_absolute_url }}">
            {{ forum.title }}
        </a>
        <p>
            {{ forum.subtitle }}
        </p>
    </div>
    <div class="forum-entry-count">
        {{ forum.get_topic_count }}
    </div>
    <div class="forum-entry-count">
        {{ forum.get_post_count }}
    </div>
    <div class="forum-entry-desc">
        <p>
            {% if forum.get_last_message %}
                <a href="{{ forum.get_last_message.get_absolute_url }}">
                    {% with date=forum.get_last_message.pubdate|humane_date %}
                        {{ date|upfirstletter }}
                    {% endwith %}
                </a>
                par
                <a href="{{ forum.get_last_message.author.get_absolute_url }}">
                    {{ forum.get_last_message.author.username }}
                </a>
                dans
                <a href="{{ forum.get_last_message.topic.get_absolute_url }}">
                    {{ forum.get_last_message.topic.title }}
                </a>
            {% else %}
                Aucun message
            {% endif %}
        </p>
    </div>
</div>
    
{% endfor %}